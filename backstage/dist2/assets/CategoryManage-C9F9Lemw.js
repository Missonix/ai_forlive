import{k as e}from"./kalodata-BgenKzbw.js";import{a,k as l}from"./element-plus-C6e0990v.js";import{x as t,X as s,r as v,h as i,y as u,P as c,H as o,ag as d,z as r,A as n,J as y,I as m,aq as g,G as p,O as b,a6 as f,M as _,L as h,D as k,u as w}from"./vue-vendor-B0tYOcBV.js";import{_ as C}from"./_plugin-vue_export-helper-B34n5pss.js";const D={class:"category-manage-container"},V={class:"card-header"},x={class:"country-selector"},S={class:"category-content"},j={class:"category-tree"},z={class:"level-column"},M={class:"category-list"},$=["onClick"],L={class:"level-column"},U={class:"category-list"},G=["onClick"],H={class:"level-column"},I={class:"category-list"},Y=["onClick"],A={key:0,class:"statistics-panel"},B={class:"statistics-header"},K={class:"statistics-info"},O={class:"country"},P={class:"category"},X={class:"statistics-content"},q={class:"stat-item"},F={class:"stat-value"},J={class:"stat-item"},N={class:"stat-value"},T={class:"fetch-latest-data"},E={class:"fetch-form"},Q={key:0,class:"date-range"},R={key:0,class:"fetch-tips"},W={key:0},Z={class:"dialog-description"},ee={class:"dialog-warning"},ae={key:1,class:"fetch-result"},le={class:"result-summary"},te={class:"summary-item"},se={class:"summary-value"},ve={class:"summary-item"},ie={class:"summary-value"},ue={class:"summary-item"},ce={class:"summary-value"},oe={class:"summary-item"},de={class:"summary-value"},re={class:"summary-item"},ne={class:"summary-value"},ye={class:"dialog-footer"},me=C(t({__name:"CategoryManage",setup(t){const C={"美国":"US","印度尼西亚":"ID","马来西亚":"MY","泰国":"TH","越南":"VN","菲律宾":"PH","英国":"GB","新加坡":"SG","墨西哥":"MX"},me=s({level1:[],level2:[],level3:[]}),ge=s({level1:!1,level2:!1,level3:!1,statistics:!1}),pe=v("MY"),be=s({level1:"",level2:"",level3:""}),fe=v(""),_e=s({total_count:0,latest_date:"",country:"",category:""}),he=v(!1),ke=v(null),we=v(!1),Ce=v(null),De=v(""),Ve=v(!1),xe=v(""),Se=v(null),je=()=>{be.level1="",be.level2="",be.level3="",fe.value="",ke.value=null,he.value=!1,ze()},ze=async()=>{try{ge.level1=!0,me.level2=[],me.level3=[];const l=await e.getLevel1Categories();200===l.data.code?me.level1=l.data.data:a.error(l.data.message||"获取一级类目失败")}catch(l){a.error("获取一级类目失败")}finally{ge.level1=!1}},Me=async(l,t)=>{he.value=!0,ge.statistics=!0;try{const s=await e.getKalodataStatistics(l,t);200===s.data.code?Object.assign(_e,s.data.data):a.error(s.data.message||"获取统计信息失败")}catch(s){a.error("获取统计信息失败")}finally{ge.statistics=!1}},$e=v(""),Le=v(!1),Ue=()=>{const e=new Date;e.setDate(e.getDate()-1);const a=new Date(e);a.setDate(a.getDate()-7);const l=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;return{startDate:l(a),endDate:l(e)}},Ge=async()=>{if(!$e.value.trim())return void a.warning("请输入Cookie");if(!ke.value)return void a.warning("请先选择一个三级类目");const{startDate:l,endDate:t}=Ue(),s={cookie:$e.value,country:pe.value,start_date:l,end_date:t,cate_ids:[ke.value.value]};Le.value=!0;try{const l=await e.fetchAndStoreKalodata(s);200===l.data.code?(a.success("数据获取成功"),await Me(pe.value,ke.value.label)):a.error(l.data.message||"获取数据失败")}catch(v){a.error("获取最新数据失败")}finally{Le.value=!1}},He=async()=>{if(!Ce.value||!De.value.trim())return void a.warning("请输入Cookie");const l={country:pe.value,category1:Ce.value.value,cookie:De.value};Ve.value=!0,xe.value=Ce.value.value;try{const t=await e.fetchByCategoryLevel1(l);Se.value=t.data,$e.value=De.value,a.success("批量获取数据成功")}catch(t){a.error("批量获取数据失败")}finally{Ve.value=!1,xe.value=""}};return i((async()=>{await ze()})),(t,s)=>{const v=d("el-option"),i=d("el-select"),ze=d("el-icon"),Ie=d("el-button"),Ye=d("el-empty"),Ae=d("el-input"),Be=d("el-card"),Ke=d("el-form-item"),Oe=d("el-form"),Pe=d("el-alert"),Xe=d("el-table-column"),qe=d("el-table"),Fe=d("el-result"),Je=d("el-dialog"),Ne=g("loading");return r(),u("div",D,[c(Be,{class:"category-card"},{header:o((()=>[n("div",V,[s[6]||(s[6]=n("div",{class:"title-area"},[n("h2",null,"类目管理")],-1)),n("div",x,[s[5]||(s[5]=n("span",{class:"selector-label"},"选择国家:",-1)),c(i,{modelValue:pe.value,"onUpdate:modelValue":s[0]||(s[0]=e=>pe.value=e),placeholder:"请选择国家",onChange:je,size:"large",style:{width:"160px"}},{default:o((()=>[(r(),u(b,null,f(C,((e,a)=>c(v,{key:e,label:a,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])])])),default:o((()=>[n("div",S,[n("div",j,[n("div",z,[s[7]||(s[7]=n("div",{class:"level-title"},"一级类目",-1)),m((r(),u("div",M,[(r(!0),u(b,null,f(me.level1,(t=>(r(),u("div",{key:t.id,class:k(["category-item",{active:be.level1===t.value}])},[n("div",{class:"category-item-content",onClick:l=>(async l=>{be.level1=l.value,be.level2="",be.level3="",fe.value="",ke.value=null,me.level2=[],me.level3=[],he.value=!1;try{ge.level2=!0;const t=await e.getLevel2Categories(l.value);200===t.data.code?me.level2=t.data.data:a.error(t.data.message||"获取二级类目失败")}catch(t){a.error("获取二级类目失败")}finally{ge.level2=!1}})(t)},_(t.label),9,$),c(Ie,{type:"primary",size:"small",class:"fetch-category-btn",onClick:e=>{return a=t,Ce.value=a,De.value=$e.value,Se.value=null,void(we.value=!0);var a},loading:t.value===xe.value},{default:o((()=>[c(ze,null,{default:o((()=>[c(w(l))])),_:1})])),_:2},1032,["onClick","loading"])],2)))),128)),0===me.level1.length?(r(),p(Ye,{key:0,description:"暂无数据"})):y("",!0)])),[[Ne,ge.level1]])]),n("div",L,[s[8]||(s[8]=n("div",{class:"level-title"},"二级类目",-1)),m((r(),u("div",U,[(r(!0),u(b,null,f(me.level2,(l=>(r(),u("div",{key:l.id,class:k(["category-item",{active:be.level2===l.value}]),onClick:t=>(async l=>{be.level2=l.value,be.level3="",fe.value="",ke.value=null,me.level3=[],he.value=!1;try{ge.level3=!0;const t=await e.getLevel3Categories(l.value);200===t.data.code?me.level3=t.data.data:a.error(t.data.message||"获取三级类目失败")}catch(t){a.error("获取三级类目失败")}finally{ge.level3=!1}})(l)},_(l.label),11,G)))),128)),0===me.level2.length?(r(),p(Ye,{key:0,description:"请先选择一级类目","image-size":80})):y("",!0)])),[[Ne,ge.level2]])]),n("div",H,[s[9]||(s[9]=n("div",{class:"level-title"},"三级类目",-1)),m((r(),u("div",I,[(r(!0),u(b,null,f(me.level3,(e=>(r(),u("div",{key:e.id,class:k(["category-item",{active:be.level3===e.value}]),onClick:a=>(async e=>{be.level3=e.value,fe.value=e.label,ke.value={label:e.label,value:e.value},await Me(pe.value,e.label)})(e)},_(e.label),11,Y)))),128)),0===me.level3.length?(r(),p(Ye,{key:0,description:"请先选择二级类目","image-size":80})):y("",!0)])),[[Ne,ge.level3]])])]),he.value?(r(),u("div",A,[m((r(),p(Be,{class:"statistics-card"},{header:o((()=>[n("div",B,[s[10]||(s[10]=n("h3",null,"数据统计",-1)),n("div",K,[n("span",O,"国家: "+_(_e.country),1),n("span",P,"类目: "+_(_e.category),1)])])])),default:o((()=>[n("div",X,[n("div",q,[s[11]||(s[11]=n("div",{class:"stat-label"},"数据总数",-1)),n("div",F,_(_e.total_count),1)]),n("div",J,[s[12]||(s[12]=n("div",{class:"stat-label"},"最新数据时间",-1)),n("div",N,_(_e.latest_date),1)])]),n("div",T,[s[16]||(s[16]=n("h4",null,"获取最新数据",-1)),n("div",E,[c(Ae,{modelValue:$e.value,"onUpdate:modelValue":s[1]||(s[1]=e=>$e.value=e),placeholder:"请输入Cookie",clearable:"",rows:3,type:"textarea",style:{"margin-bottom":"15px"}},null,8,["modelValue"]),c(Ie,{type:"primary",onClick:Ge,loading:Le.value,disabled:!ke.value},{default:o((()=>[s[13]||(s[13]=h(" 获取最新数据 ")),ke.value?(r(),u("span",Q," ("+_(Ue().startDate)+" 至 "+_(Ue().endDate)+") ",1)):y("",!0)])),_:1},8,["loading","disabled"])]),ke.value?(r(),u("div",R,[n("p",null,[s[14]||(s[14]=h(" 将获取国家 ")),n("b",null,_(pe.value),1),s[15]||(s[15]=h(" 类目 ")),n("b",null,_(ke.value.label),1),h("("+_(ke.value.value)+") 的最新数据 ",1)])])):y("",!0)])])),_:1})),[[Ne,ge.statistics]])])):y("",!0)])])),_:1}),c(Je,{modelValue:we.value,"onUpdate:modelValue":s[4]||(s[4]=e=>we.value=e),title:"批量获取类目数据",width:"600px","destroy-on-close":""},{footer:o((()=>[n("span",ye,[c(Ie,{onClick:s[3]||(s[3]=e=>we.value=!1)},{default:o((()=>s[25]||(s[25]=[h("关闭")]))),_:1}),Se.value?y("",!0):(r(),p(Ie,{key:0,type:"primary",onClick:He,loading:Ve.value,disabled:!De.value||!Ce.value},{default:o((()=>s[26]||(s[26]=[h(" 确认获取 ")]))),_:1},8,["loading","disabled"]))])])),default:o((()=>{var e;return[Se.value?(r(),u("div",ae,[c(Fe,{icon:"success",title:Se.value.message,"sub-title":`新增: ${Se.value.data.success_count} 条, 跳过: ${Se.value.data.skip_count} 条, 失败类目: ${Se.value.data.failed_categories_count} 个`},{extra:o((()=>[n("div",le,[n("div",te,[s[19]||(s[19]=n("div",{class:"summary-label"},"一级类目",-1)),n("div",se,_(Se.value.data.category1_value),1)]),n("div",ve,[s[20]||(s[20]=n("div",{class:"summary-label"},"国家",-1)),n("div",ie,_(Se.value.data.country),1)]),n("div",ue,[s[21]||(s[21]=n("div",{class:"summary-label"},"二级类目数",-1)),n("div",ce,_(Se.value.data.total_category2),1)]),n("div",oe,[s[22]||(s[22]=n("div",{class:"summary-label"},"三级类目数",-1)),n("div",de,_(Se.value.data.total_category3),1)]),n("div",re,[s[23]||(s[23]=n("div",{class:"summary-label"},"日期范围",-1)),n("div",ne,_(Se.value.data.start_date)+" 至 "+_(Se.value.data.end_date),1)])]),Se.value.data.failed_categories.length>0?(r(),u(b,{key:0},[s[24]||(s[24]=n("h4",{class:"failed-title"},"失败的类目:",-1)),c(qe,{data:Se.value.data.failed_categories,style:{width:"100%"},size:"small",border:!0},{default:o((()=>[c(Xe,{prop:"category3_label",label:"类目名称",width:"180"}),c(Xe,{prop:"error",label:"错误原因"})])),_:1},8,["data"])],64)):y("",!0)])),_:1},8,["title","sub-title"])])):(r(),u("div",W,[n("p",Z,[s[17]||(s[17]=h(" 将根据选择的一级类目 ")),n("b",null,_(null==(e=Ce.value)?void 0:e.label),1),s[18]||(s[18]=h(" 批量获取该类目下所有三级类目的数据。 "))]),c(Oe,{"label-position":"top"},{default:o((()=>[c(Ke,{label:"Cookie"},{default:o((()=>[c(Ae,{modelValue:De.value,"onUpdate:modelValue":s[2]||(s[2]=e=>De.value=e),type:"textarea",rows:3,placeholder:"请输入Cookie"},null,8,["modelValue"])])),_:1})])),_:1}),n("div",ee,[c(Pe,{title:"注意：数据获取可能需要较长时间，请耐心等待",type:"warning",closable:!1,"show-icon":""})])]))]})),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-b2d9b355"]]);export{me as default};
