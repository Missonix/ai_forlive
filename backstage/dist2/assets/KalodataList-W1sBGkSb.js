import{k as a}from"./kalodata-BgenKzbw.js";import{a as e,e as l,s as t,v as o,f as i,j as r}from"./element-plus-C6e0990v.js";import{x as s,r as n,h as u,y as d,P as c,H as p,ag as v,z as g,I as f,A as h,aq as _,G as m,L as w,M as y,u as b,O as k,a6 as z,J as C}from"./vue-vendor-B0tYOcBV.js";import{_ as x}from"./_plugin-vue_export-helper-B34n5pss.js";const V={class:"kalodata-container"},$={class:"card-header"},j={class:"title-area"},S={class:"filter-container"},L={class:"country-filter"},M={class:"category-filter"},P={class:"pagination"},U={class:"video-container"},T=["src"],G={key:0,class:"video-info"},I={class:"info-grid"},A={class:"info-item"},H={class:"info-value"},K={class:"info-item"},O={class:"info-value"},B={class:"info-item"},D={class:"info-value"},R={class:"info-item"},Y={class:"info-value"},q=x(s({__name:"KalodataList",setup(s){const x={"美国":"US","印度尼西亚":"ID","马来西亚":"MY","泰国":"TH","越南":"VN","菲律宾":"PH","英国":"GB","新加坡":"SG","墨西哥":"MX"},q=n([]),F=n(!1),J=n("MY"),N=n(1),W=n(10),X=n(0),E=n([]),Q=n([]),Z=n(""),aa=n({}),ea={label:"label",value:"value",children:"children",checkStrictly:!1,lazy:!0,lazyLoad(a,e){const{level:l,value:t}=a;0!==l?1===l?la(t,e):2===l&&ta(t,e):e([])}},la=async(l,t)=>{try{if(aa.value[`level2_${l}`])return void t(aa.value[`level2_${l}`]);const o=await a.getLevel2Categories(l);if(200===o.data.code){const a=o.data.data.map((a=>({...a,leaf:!1})));aa.value[`level2_${l}`]=a,t(a)}else e.error(o.data.message||"获取二级类目失败"),t([])}catch(o){e.error("获取二级类目失败"),t([])}},ta=async(l,t)=>{try{if(aa.value[`level3_${l}`])return void t(aa.value[`level3_${l}`]);const o=await a.getLevel3Categories(l);if(200===o.data.code){const a=o.data.data.map((a=>({...a,leaf:!0})));aa.value[`level3_${l}`]=a,t(a)}else e.error(o.data.message||"获取三级类目失败"),t([])}catch(o){e.error("获取三级类目失败"),t([])}},oa=()=>{if(Q.value&&3===Q.value.length){const a=`level3_${Q.value[1]}`,e=(aa.value[a]||[]).find((a=>a.value===Q.value[2]));Z.value=e?e.label:"",N.value=1,ua()}},ia=n(!1),ra=n(""),sa=n(null),na=n(null),ua=async()=>{try{F.value=!0;const l={...{country:J.value,page:N.value,page_size:W.value}};Q.value&&3===Q.value.length&&Z.value&&(l.category=Z.value);const t=await a.getKalodataByFilters(l);200===t.data.code?(q.value=t.data.data.items,X.value=t.data.data.total):e.error(t.data.message||"获取数据失败")}catch(l){e.error("获取数据失败")}finally{F.value=!1}},da=()=>{N.value=1,ua()},ca=a=>{N.value=a,ua()},pa=a=>{W.value=a,N.value=1,ua()},va=()=>{Q.value=[],Z.value="",N.value=1,ua()};return u((async()=>{await(async()=>{try{const l=await a.getLevel1Categories();if(200===l.data.code){const a=l.data.data.map((a=>({...a,leaf:!1})));E.value=a,aa.value.level1=a}else e.error(l.data.message||"获取类目失败")}catch(l){e.error("获取类目失败")}})(),ua()})),(a,s)=>{const n=v("el-icon"),u=v("el-button"),Z=v("el-option"),aa=v("el-select"),la=v("el-cascader"),ta=v("el-table-column"),ua=v("el-tag"),ga=v("el-button-group"),fa=v("el-table"),ha=v("el-pagination"),_a=v("el-card"),ma=v("el-dialog"),wa=_("loading");return g(),d("div",V,[c(_a,{class:"kalodata-card"},{header:p((()=>[h("div",$,[h("div",j,[s[7]||(s[7]=h("h2",null,"Kalodata 数据管理",-1)),c(u,{type:"primary",size:"small",onClick:s[0]||(s[0]=e=>a.$router.push("/category-manage")),style:{"margin-left":"15px"}},{default:p((()=>[c(n,null,{default:p((()=>[c(b(i))])),_:1}),s[6]||(s[6]=w(" 类目管理 "))])),_:1})]),h("div",S,[h("div",L,[s[8]||(s[8]=h("span",{class:"filter-label"},"选择国家:",-1)),c(aa,{modelValue:J.value,"onUpdate:modelValue":s[1]||(s[1]=a=>J.value=a),placeholder:"请选择国家",onChange:da,style:{width:"160px"},size:"large"},{default:p((()=>[(g(),d(k,null,z(x,((a,e)=>c(Z,{key:a,label:e,value:a},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])]),h("div",M,[s[10]||(s[10]=h("span",{class:"filter-label"},"选择类目:",-1)),c(la,{modelValue:Q.value,"onUpdate:modelValue":s[2]||(s[2]=a=>Q.value=a),options:E.value,props:ea,placeholder:"请选择类目",style:{width:"420px"},onChange:oa,clearable:"",size:"large"},null,8,["modelValue","options"]),c(u,{type:"primary",size:"large",onClick:va,style:{"margin-left":"10px"}},{default:p((()=>[c(n,null,{default:p((()=>[c(b(r))])),_:1}),s[9]||(s[9]=w(" 清空类目 "))])),_:1})])])])])),default:p((()=>[f((g(),m(fa,{data:q.value,style:{width:"100%"},border:"",stripe:"","header-cell-style":{background:"#f0f6fc",color:"#333",fontWeight:"bold"},"cell-style":{padding:"8px 0"},"highlight-current-row":""},{default:p((()=>[c(ta,{prop:"id",label:"ID",width:"70",align:"center"}),c(ta,{prop:"country",label:"国家",width:"80",align:"center"}),c(ta,{prop:"has_ad",label:"是否有广告",width:"110",align:"center"},{default:p((({row:a})=>[c(ua,{type:a.has_ad?"success":"info",effect:"dark",size:"small"},{default:p((()=>[w(y(a.has_ad?"有":"无"),1)])),_:2},1032,["type"])])),_:1}),c(ta,{prop:"video_name",label:"视频名称","min-width":"250","show-overflow-tooltip":""}),c(ta,{prop:"gpm",label:"GPM",width:"100",align:"right"}),c(ta,{prop:"cpm",label:"CPM",width:"100",align:"right"}),c(ta,{prop:"ad_view_ratio",label:"广告观看率",width:"120",align:"right"}),c(ta,{prop:"duration",label:"时长",width:"80",align:"center"}),c(ta,{prop:"revenue",label:"收入",width:"100",align:"right"}),c(ta,{prop:"sales",label:"销量",width:"80",align:"right"}),c(ta,{prop:"roas",label:"ROAS",width:"100",align:"right"}),c(ta,{prop:"views",label:"观看量",width:"100",align:"right"}),c(ta,{prop:"username",label:"用户名",width:"120"}),c(ta,{prop:"follower_count",label:"粉丝数",width:"100",align:"right"}),c(ta,{prop:"product_title",label:"产品标题","min-width":"250","show-overflow-tooltip":""}),c(ta,{prop:"category1",label:"一级分类",width:"120"}),c(ta,{prop:"category2",label:"二级分类",width:"140"}),c(ta,{prop:"category3",label:"三级分类",width:"150"}),c(ta,{prop:"product_price",label:"产品价格",width:"100",align:"right"}),c(ta,{label:"操作",width:"260",fixed:"right",align:"center"},{default:p((({row:a})=>[c(ga,null,{default:p((()=>[c(u,{type:"primary",onClick:l=>{var t;(t=a.tiktok_url)?window.open(t,"_blank"):e.warning("无效的TikTok链接")},size:"small"},{default:p((()=>[c(n,null,{default:p((()=>[c(b(l))])),_:1}),s[11]||(s[11]=w(" TikTok "))])),_:2},1032,["onClick"]),c(u,{type:"success",onClick:l=>{var t;(t=a.product_url)?window.open(t,"_blank"):e.warning("无效的商品链接")},size:"small"},{default:p((()=>[c(n,null,{default:p((()=>[c(b(t))])),_:1}),s[12]||(s[12]=w(" 商品 "))])),_:2},1032,["onClick"]),c(u,{type:"warning",onClick:l=>(a=>{a.video_url?(ia.value=!0,ra.value=a.video_url,sa.value=a):e.warning("无效的视频链接")})(a),size:"small"},{default:p((()=>[c(n,null,{default:p((()=>[c(b(o))])),_:1}),s[13]||(s[13]=w(" 预览 "))])),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[wa,F.value]]),h("div",P,[c(ha,{"current-page":N.value,"onUpdate:currentPage":s[3]||(s[3]=a=>N.value=a),"page-size":W.value,"onUpdate:pageSize":s[4]||(s[4]=a=>W.value=a),"page-sizes":[10,20,50,100],total:X.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:pa,onCurrentChange:ca,background:""},null,8,["current-page","page-size","total"])])])),_:1}),c(ma,{modelValue:ia.value,"onUpdate:modelValue":s[5]||(s[5]=a=>ia.value=a),title:"视频预览",width:"700px",center:"","destroy-on-close":""},{default:p((()=>[h("div",U,[ra.value?(g(),d("video",{key:0,ref_key:"videoPlayer",ref:na,controls:"",autoplay:"",width:"100%",src:ra.value,style:{"border-radius":"8px","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.15)"}},null,8,T)):C("",!0)]),sa.value?(g(),d("div",G,[h("h3",null,y(sa.value.video_name),1),h("div",I,[h("div",A,[s[14]||(s[14]=h("span",{class:"info-label"},"用户：",-1)),h("span",H,y(sa.value.username)+" ("+y(sa.value.follower_count)+" 粉丝)",1)]),h("div",K,[s[15]||(s[15]=h("span",{class:"info-label"},"产品：",-1)),h("span",O,y(sa.value.product_title),1)]),h("div",B,[s[16]||(s[16]=h("span",{class:"info-label"},"价格：",-1)),h("span",D,y(sa.value.product_price),1)]),h("div",R,[s[17]||(s[17]=h("span",{class:"info-label"},"数据：",-1)),h("span",Y," 销量 "+y(sa.value.sales)+"，观看 "+y(sa.value.views)+"，ROAS "+y(sa.value.roas),1)])])])):C("",!0)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-b669e73b"]]);export{q as default};
