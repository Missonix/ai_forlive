import{x as e,r as a,h as l,y as t,P as s,H as r,ag as d,z as u,A as o,I as p,a4 as i,L as n,aq as c,G as v,M as f}from"./vue-vendor-B0tYOcBV.js";import{a as m,_ as h}from"./_plugin-vue_export-helper-B34n5pss.js";import{a as _,c as w}from"./element-plus-C6e0990v.js";const g="/api",y=e=>m.post(`${g}/users`,e),b=(e,a)=>m.put(`${g}/users/${e}`,a),V=()=>m.get(`${g}/users`),k=e=>m.post(`${g}/users/search`,{phone_prefix:e}),C=e=>m.delete(`${g}/users/${e}`),$={class:"user-list"},x={class:"card-header"},U={class:"search-bar"},j={class:"dialog-footer"},q=h(e({__name:"UserList",setup(e){const m=a([]),h=a(!1),g=a(""),q=a(!1),I=a("add"),L=a(""),z=a(0),A=a(),D=a({phone:"",password:""}),G={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]},H=async()=>{try{h.value=!0;const e=await V();m.value=e.data.data}catch(e){_.error("获取用户列表失败")}finally{h.value=!1}},K=async()=>{if(g.value)try{h.value=!0;const e=await k(g.value);200===e.data.code?(m.value=e.data.data.items,z.value=e.data.data.total,0===m.value.length&&_.info("未找到匹配的用户")):_.error(e.data.message||"搜索失败")}catch(e){_.error("搜索用户失败")}finally{h.value=!1}else await H()},M=()=>{I.value="add",D.value={phone:"",password:""},q.value=!0},P=async()=>{A.value&&await A.value.validate((async e=>{if(e)try{"add"===I.value?(await y(D.value),_.success("创建成功")):(await b(L.value,{password:D.value.password}),_.success("更新成功")),q.value=!1,await H()}catch(a){_.error("add"===I.value?"创建失败":"更新失败")}}))};return l((()=>{H()})),(e,a)=>{const l=d("el-button"),y=d("el-input"),b=d("el-table-column"),V=d("el-tag"),k=d("el-button-group"),z=d("el-table"),R=d("el-card"),B=d("el-form-item"),E=d("el-form"),F=d("el-dialog"),J=c("loading");return u(),t("div",$,[s(R,null,{header:r((()=>[o("div",x,[a[6]||(a[6]=o("span",null,"用户管理",-1)),s(l,{type:"primary",onClick:M},{default:r((()=>a[5]||(a[5]=[n("新增用户")]))),_:1})])])),default:r((()=>[o("div",U,[s(y,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),placeholder:"请输入手机号搜索",class:"search-input",onKeyup:i(K,["enter"])},{append:r((()=>[s(l,{onClick:K},{default:r((()=>a[7]||(a[7]=[n("搜索")]))),_:1})])),_:1},8,["modelValue"])]),p((u(),v(z,{data:m.value,style:{width:"100%"}},{default:r((()=>[s(b,{prop:"user_id",label:"用户ID",width:"220"}),s(b,{prop:"phone",label:"手机号",width:"150"}),s(b,{prop:"is_deleted",label:"状态",width:"100"},{default:r((({row:e})=>[s(V,{type:e.is_deleted?"danger":"success"},{default:r((()=>[n(f(e.is_deleted?"已删除":"正常"),1)])),_:2},1032,["type"])])),_:1}),s(b,{prop:"last_login",label:"最后登录时间",width:"180"},{default:r((({row:e})=>[n(f(e.last_login||"未登录"),1)])),_:1}),s(b,{prop:"created_at",label:"创建时间",width:"180"}),s(b,{label:"操作",fixed:"right",width:"200"},{default:r((({row:e})=>[s(k,null,{default:r((()=>[s(l,{type:"primary",link:"",onClick:a=>(e=>{I.value="edit",L.value=e.user_id,D.value={phone:e.phone,password:""},q.value=!0})(e)},{default:r((()=>a[8]||(a[8]=[n("编辑")]))),_:2},1032,["onClick"]),s(l,{type:"danger",link:"",onClick:a=>(async e=>{try{await w.confirm("确定要删除该用户吗？","提示",{type:"warning"}),await C(e.user_id),_.success("删除成功"),await H()}catch(a){"cancel"!==a&&_.error("删除失败")}})(e)},{default:r((()=>a[9]||(a[9]=[n("删除")]))),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[J,h.value]])])),_:1}),s(F,{modelValue:q.value,"onUpdate:modelValue":a[4]||(a[4]=e=>q.value=e),title:"add"===I.value?"新增用户":"编辑用户",width:"500px"},{footer:r((()=>[o("span",j,[s(l,{onClick:a[3]||(a[3]=e=>q.value=!1)},{default:r((()=>a[10]||(a[10]=[n("取消")]))),_:1}),s(l,{type:"primary",onClick:P},{default:r((()=>a[11]||(a[11]=[n("确定")]))),_:1})])])),default:r((()=>[s(E,{ref_key:"formRef",ref:A,model:D.value,rules:G,"label-width":"100px"},{default:r((()=>[s(B,{label:"手机号",prop:"phone"},{default:r((()=>[s(y,{modelValue:D.value.phone,"onUpdate:modelValue":a[1]||(a[1]=e=>D.value.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),s(B,{label:"密码",prop:"password"},{default:r((()=>[s(y,{modelValue:D.value.password,"onUpdate:modelValue":a[2]||(a[2]=e=>D.value.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-fcf6b9ea"]]);export{q as default};
